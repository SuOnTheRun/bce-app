<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Behavioral Context Engine</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <div class="appShell">

    <!-- Top Bar -->
    <header class="topBar">
      <div class="brand">
        <div class="brandTitle">Behavioral Context Engine</div>
        <div class="brandSub">Strategy-owned. One-page briefs. Decision-grade clarity.</div>
      </div>

      <div class="topActions">
        <a class="btnGhost" href="/template">Download Excel Template</a>

        {% if output and output.provider %}
          <div class="badge">
            <span class="dot"></span>
            <span class="badgeText">Provider: {{ output.provider }}</span>
          </div>
        {% endif %}
      </div>
    </header>

    <!-- Layout -->
    <main class="layout">
      <!-- LEFT: Decision Setup -->
      <aside class="panel panelLeft">
        <div class="panelHeader">
          <div class="panelTitle">Decision Setup</div>
          <div class="panelHint">Inputs are supporting evidence. The decision is the output.</div>
        </div>

        {% if error %}
          <div class="alert alertError">
            <div class="alertTitle">Error</div>
            <div class="alertBody mono">{{ error }}</div>
          </div>
        {% endif %}

        <form action="/generate" method="post" enctype="multipart/form-data" class="form">

          <!-- Campaign Frame -->
          <section class="card">
            <div class="cardTop">
              <div class="cardTitle">Campaign frame</div>
              <div class="cardSub">Keep it debranded. Short, specific.</div>
            </div>

            <div class="grid2">
              <div>
                <label class="label">Category *</label>
                <input class="input" type="text" name="category" placeholder="Retail" value="{{ (input_used.campaign.Category if input_used) or '' }}" />
              </div>

              <div>
                <label class="label">Market *</label>
                <input class="input" type="text" name="market" placeholder="US – NYC" value="{{ (input_used.campaign.Market if input_used) or '' }}" />
              </div>

              <div class="span2">
                <label class="label">Objective *</label>
                <input class="input" type="text" name="objective" placeholder="Drive incremental in-store footfall during promo window"
                       value="{{ (input_used.campaign.Objective if input_used) or '' }}" />
              </div>
            </div>
          </section>

          <!-- Behavioral Assumptions (Hero Input) -->
          <section class="card heroCard">
            <div class="cardTop">
              <div class="cardTitle">Behavioral context *</div>
              <div class="cardSub">Plain English. Describe the decision moment and why it’s unstable.</div>
            </div>

            <textarea class="input textarea heroTextarea" name="audience_logic"
              placeholder="Example: People passing retail locations during routine travel, where detour cost is low and urgency can justify a stop.">{{ (input_used.campaign.Audience_Logic if input_used) or '' }}</textarea>

            <div class="microHint">
              What we’re looking for: <span class="mono">moment + route + tension</span>
            </div>
          </section>

          <!-- Evidence (Collapsible) -->
          <details class="accordion">
            <summary class="accordionSummary">
              <span>Add supporting evidence</span>
              <span class="accordionHint">Channels, measurement, creative, notes, upload</span>
            </summary>

            <section class="card">
              <div class="grid2">
                <div class="span2">
                  <label class="label">Excel upload (optional)</label>
                  <input class="input" type="file" name="excel" accept=".xlsx" />
                </div>

                <div class="span2">
                  <label class="label">Channels *</label>
                  <input class="input" type="text" name="channels" placeholder="DOOH, Display"
                         value="{{ (input_used.campaign.Channels if input_used) or '' }}" />
                </div>

                <div>
                  <label class="label">Flight dates</label>
                  <input class="input" type="text" name="flight_dates" placeholder="2025-10-01 to 2025-10-21"
                         value="{{ (input_used.campaign.Flight_Dates if input_used) or '' }}" />
                </div>

                <div>
                  <label class="label">Measurement type</label>
                  <input class="input" type="text" name="measurement_type" placeholder="Footfall / BLS / Brand Lift"
                         value="{{ (input_used.campaign.Measurement_Type if input_used) or '' }}" />
                </div>

                <div class="span2">
                  <label class="label">Creative notes</label>
                  <textarea class="input textarea" name="creative_notes"
                    placeholder="What it said, what it looked like. No brand names.">{{ (input_used.campaign.Creative_Notes if input_used) or '' }}</textarea>
                </div>

                <div class="span2">
                  <label class="label">POI / journey context</label>
                  <input class="input" type="text" name="poi_context"
                         placeholder="Transit exits, commuter corridors, retail frontage, last-mile walk zones..."
                         value="{{ (input_used.campaign.POI_Context if input_used) or '' }}" />
                </div>

                <div class="span2">
                  <label class="label">Key result</label>
                  <input class="input" type="text" name="key_result"
                         placeholder="Directional uplift observed / +X% uplift"
                         value="{{ (input_used.campaign.Key_Result if input_used) or '' }}" />
                </div>

                <div class="span2">
                  <label class="label">Notes</label>
                  <textarea class="input textarea" name="notes"
                    placeholder="Seasonality, anomalies, constraints, competitor events.">{{ (input_used.campaign.Notes if input_used) or '' }}</textarea>
                </div>
              </div>
            </section>
          </details>

          <button class="btnPrimary" type="submit">Generate Brief</button>

          <div class="tinyMeta">
            {% if output and output.models %}
              <span class="mono muted">Models: A={{ output.models.pass_a }}, B={{ output.models.pass_b }}</span>
            {% endif %}
          </div>
        </form>
      </aside>

      <!-- RIGHT: Decision Brief -->
      <section class="panel panelRight">
        <div class="panelHeader">
          <div>
            <div class="panelTitle">Behavioral Context Brief</div>
            <div class="panelHint">Designed to be scanned in under 10 seconds.</div>
          </div>
        </div>

        {% if output and output.dm %}
          <!-- 1) Decision Headline -->
          <section class="briefCard briefHero">
            <div class="kicker">Executive decision headline</div>
            <div class="headline">
              {{ output.headline }}
            </div>
            <div class="subline">
              {{ output.subhead }}
            </div>
          </section>

          <!-- 2) Why This Works -->
          <section class="briefCard">
            <div class="sectionTitle">Why this works</div>
            <ul class="bullets">
              {% for b in output.why_this_works %}
                <li>{{ b }}</li>
              {% endfor %}
            </ul>
          </section>

          <!-- 3) Moment of Influence -->
          <section class="briefCard">
            <div class="sectionTitle">Moment of influence</div>
            <div class="momentGrid">
              <div class="momentRow">
                <div class="momentKey">WHEN</div>
                <div class="momentVal">{{ output.dm.moment_of_instability.when }}</div>
              </div>
              <div class="momentRow">
                <div class="momentKey">WHERE</div>
                <div class="momentVal">{{ output.dm.moment_of_instability.where }}</div>
              </div>
              <div class="momentRow">
                <div class="momentKey">WHY</div>
                <div class="momentVal">{{ output.dm.moment_of_instability.why_here_not_elsewhere }}</div>
              </div>
            </div>
          </section>

          <!-- 4) Observed vs Inferred vs Hypothesis -->
          <section class="briefCard">
            <div class="sectionTitle">Signals</div>
            <div class="signalCols">
              <div class="signalCol">
                <div class="signalHead">Observed</div>
                <ul class="bullets tight">
                  {% for s in output.signals.observed %}
                    <li>{{ s }}</li>
                  {% endfor %}
                  {% if output.signals.observed|length == 0 %}
                    <li class="muted">None provided</li>
                  {% endif %}
                </ul>
              </div>

              <div class="signalCol">
                <div class="signalHead">Inferred</div>
                <ul class="bullets tight">
                  {% for s in output.signals.inferred %}
                    <li>{{ s }}</li>
                  {% endfor %}
                  {% if output.signals.inferred|length == 0 %}
                    <li class="muted">None provided</li>
                  {% endif %}
                </ul>
              </div>

              <div class="signalCol">
                <div class="signalHead">Hypothesis</div>
                <ul class="bullets tight">
                  {% for s in output.signals.hypothesis %}
                    <li>{{ s }}</li>
                  {% endfor %}
                  {% if output.signals.hypothesis|length == 0 %}
                    <li class="muted">None provided</li>
                  {% endif %}
                </ul>
              </div>
            </div>
          </section>

          <!-- 5) Planning Implication -->
          <section class="briefCard">
            <div class="sectionTitle">Planning implication</div>
            <div class="planningBlock">
              <div class="planningLead">What to prioritise</div>
              <div class="planningText">{{ output.dm.planning_implications.what_to_prioritize }}</div>

              <div class="divider"></div>

              <div class="planningLead">What to avoid</div>
              <div class="planningText">{{ output.dm.planning_implications.what_to_avoid }}</div>

              <div class="divider"></div>

              <div class="planningLead">Channel role logic</div>
              <div class="planningText">{{ output.dm.planning_implications.channel_role_logic }}</div>
            </div>
          </section>

          <!-- 6) Confidence -->
          <section class="briefCard briefFooter">
            <div class="confLine">
              <div class="confLeft">
                <div class="sectionTitle">Confidence</div>
                <div class="confLevel">{{ output.dm.confidence_assessment.level }}</div>
              </div>
              <div class="confRight">
                <div class="confMeta">
                  <div class="confMetaKey">Drivers</div>
                  <div class="confMetaVal">{{ output.dm.confidence_assessment.drivers | join(" • ") }}</div>
                </div>
                <div class="confMeta">
                  <div class="confMetaKey">Limitations</div>
                  <div class="confMetaVal">{{ output.dm.confidence_assessment.limitations | join(" • ") }}</div>
                </div>
              </div>
            </div>

            <details class="details">
              <summary>Show Decision Map JSON (internal)</summary>
              <pre class="mono small">{{ output.decision_map_json }}</pre>
            </details>

            <details class="details">
              <summary>Show input used</summary>
              <pre class="mono small">{{ input_used }}</pre>
            </details>
          </section>

        {% else %}
          <section class="briefEmpty">
            <div class="emptyTitle">Generate a brief to see output here.</div>
            <div class="emptySub">This panel becomes the decision artifact. The left panel is just setup.</div>
          </section>
        {% endif %}
      </section>
    </main>

    <footer class="footer">
      <div class="footerText">Decision hygiene, not generic insights. Built for internal velocity.</div>
    </footer>

  </div>
</body>
</html>
